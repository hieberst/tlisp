                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ONLY FORTH DOS ALSO FORTH DEFINITIONS                                                                                           : ENDPGM (S --> )           \ Utility: Ab hier sind im Textfile    ['] (KEY)    IS KEY      \ ======== freie Texte zul„ssig.       ['] (?ERROR) IS ?ERROR                                          [COMPILE] [ END? ON                                          ; IMMEDIATE                                                                                                                     CREATE REC     B/REC ALLOT  \ 128-Byte-Disk-Puffer              CREATE OFS     0 C,         \ 1-Byte-Record-Offset              CREATE CR-FLAG 0 C,         \ 1-Byte-Zeilen-Flag                                                                                : TF-?ERROR (S adr cnt f --> ) \ reset text input system           DUP IF [COMPILE] ENDPGM THEN (?ERROR)                        ;                                                               -->                                                                                                                             : READ-SEQ                                                         OFS C@ 0= IF                                                      FILE @ 20 BDOS                                                ELSE                                                              0                                                             THEN                                                         ;                                                                                                                               : NEXT-CHAR                                                        REC OFS C@ + C@                                                 OFS C@ 1+ DUP B/REC = IF DROP 0 THEN OFS C!                  ;                                                                                                                                                                                               -->                                                             : FILE-KEY (S c --> )  \ liest ein einzelnes Zeichen               BEGIN                                                              READ-SEQ       1 = IF   BL ( dummy key )                                                [COMPILE] ENDPGM EXIT                                      THEN \ Dateiende ==>                         NEXT-CHAR ( char. ) 127 AND                                     DUP BL < ( Steuerzeichen? )                                        IF   DROP CR-FLAG C@ 0=                                                    ( keine multi-CR-Falle? )                                 IF   13 ( cr ) 1 ( flag ) 1 ( untilflag)                        ELSE ( % )                0 ( untilflag)                        THEN                                                       ELSE ( Zeichen) 0 ( Flag ) 1 ( UNTIL-Flag)                      THEN                                                      UNTIL                                                           ( Flag ) CR-FLAG C! ;                                  -->   : TFLOAD (S --> ) \ Textfile-Load                               \ ======                                                           REC SET-DMA                                                  \  1 FILE @ 14 + !                                                 0 FILE @ 12 + !                                                 0 FILE @ 32 + C!                                                0 CR-FLAG C!                                                    ['] TF-?ERROR IS ?ERROR                                         ['] FILE-KEY  IS KEY    ;                                                                                                    : ENDIF [COMPILE] THEN ; IMMEDIATE                                                                                              : \ (S --> )                                                       BLK @ IF   [COMPILE] \                                                ELSE END? ON                                                    ENDIF ; IMMEDIATE                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                : ENDPGM (S --> )           \ Utility: Ab hier sind im Textfile    ['] (KEY)    IS KEY      \ ======== freie Texte zul„ssig.       ['] (?ERROR) IS ?ERROR                                          [COMPILE] [ END? ON                                          ; IMMEDIATE                                                                                                                     VARIABLE REC   \ 1-Byte-Disk-Puffer, 1-Byte-Zeilen-Flag                                                                         : TF-?ERROR (S adr cnt f --> ) \ reset text input system           DUP IF [COMPILE] ENDPGM THEN (?ERROR)                        ;                                                                                                                                                                                                                                                               -->                                                             : FILE-KEY (S c --> )  \ liest ein einzelnes Zeichen               BEGIN                                                              FILE @ 20 BDOS 1 = IF   BL ( dummy key )                                                [COMPILE] ENDPGM EXIT                                      THEN \ Dateiende ==>                         REC C@ ( char. ) 127 AND                                        DUP BL < ( Steuerzeichen? )                                        IF   DROP  REC 1+ C@ 0=                                                    ( keine multi-CR-Falle? )                                 IF   13 ( cr ) 1 ( flag ) 1 ( untilflag)                        ELSE ( % )                0 ( untilflag)                        THEN                                                       ELSE ( Zeichen) 0 ( Flag ) 1 ( UNTIL-Flag)                      THEN                                                      UNTIL                                                           ( Flag) REC 1+ C! ;                                    -->   : TFLOAD (S --> ) \ Textfile-Load                               \ ======                                                           REC 26 BDOS DROP ( flag )                                       1 FILE @ 14 + !                                                 0 FILE @ 12 + !                                                 0 FILE @ 32 + C!                                                0 REC 1+ C!                                                     ['] TF-?ERROR IS ?ERROR                                         ['] FILE-KEY  IS KEY    ;                                                                                                    : ENDIF [COMPILE] THEN ; IMMEDIATE                                                                                              : \ (S --> )                                                       BLK @ IF   [COMPILE] \                                                ELSE END? ON                                                    ENDIF ; IMMEDIATE                                      